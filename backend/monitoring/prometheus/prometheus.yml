# Prometheus Configuration
# Scrapes metrics from all Shabou Auto Pi√®ces services

global:
  scrape_interval: 15s # Scrape metrics every 15 seconds
  scrape_timeout: 10s  # Timeout after 10 seconds
  evaluation_interval: 15s # Evaluate rules every 15 seconds

  external_labels:
    cluster: 'shabou-autopieces'
    environment: '${ENVIRONMENT:-production}'

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - 'alertmanager:9093'

# Load rules
rule_files:
  - '/etc/prometheus/rules/*.yml'

# Scrape configurations
scrape_configs:
  # ========================================
  # Prometheus itself
  # ========================================
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # ========================================
  # API Service (Node.js/Fastify)
  # ========================================
  - job_name: 'api'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['api:3000']
        labels:
          service: 'api'
          app: 'shabou-autopieces'

  # ========================================
  # Prospector Agent (Python/FastAPI)
  # ========================================
  - job_name: 'prospector'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['prospector:8001']
        labels:
          service: 'prospector'
          app: 'shabou-autopieces'

  # ========================================
  # Orion Agent (Python/FastAPI)
  # ========================================
  - job_name: 'orion'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['orion:8002']
        labels:
          service: 'orion'
          app: 'shabou-autopieces'

  # ========================================
  # PostgreSQL Exporter
  # ========================================
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres-exporter:9187']
        labels:
          service: 'postgres'
          app: 'shabou-autopieces'

  # ========================================
  # Redis Exporter
  # ========================================
  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']
        labels:
          service: 'redis'
          app: 'shabou-autopieces'

  # ========================================
  # Node Exporter (System Metrics)
  # ========================================
  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']
        labels:
          service: 'node-exporter'
          app: 'shabou-autopieces'

  # ========================================
  # cAdvisor (Container Metrics)
  # ========================================
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080']
        labels:
          service: 'cadvisor'
          app: 'shabou-autopieces'
